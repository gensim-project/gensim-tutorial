\subsection{Syntax Description}

\begin{frame}{Syntax Description}
%Section title slide
\end{frame}

\begin{frame}{Overview}

How are instructions encoded?

How do we decode them?

\end{frame}

\begin{frame}{GenSim Assumptions}

GenSim currently makes a few assumptions about instruction encoding:
\begin{itemize}
\item Instruction decoding is stateless
\item Instructions are standalone
\item Instructions execute in PC order
\end{itemize}

\end{frame}

\begin{frame}{GenSim Assumptions}

However, GenSim does have native support for the following features:
\begin{itemize}
\item Instruction Predication
\item Variable Length Instructions
\end{itemize}

\end{frame}


\begin{frame}{Formats}

Formats described using printf-like string
\begin{itemize}
\item Inspired by ArchC
\item Specify constant and variable fields
\end{itemize}

\end{frame}

\begin{frame}{Formats}

\centering
ARM Data-Processing (Register) Format
\includegraphics[width=\textwidth]{figures/format-arm}

\bigskip

PowerPC B-Form
\includegraphics[width=\textwidth]{figures/format-ppc}

\bigskip

RISC-V R-Type
\includegraphics[width=\textwidth]{figures/format-riscv}

\end{frame}

\begin{frame}[fragile]{Formats}

PowerPC B-Form

\includegraphics[width=\textwidth]{figures/format-ppc}

\begin{lstlisting}
"%opcd:6 %bo:5 %bi:5 %bd:14 %aa:1 %lk:1";
\end{lstlisting}

\bigskip

RISC-V R-Type

\includegraphics[width=\textwidth]{figures/format-riscv}

\begin{lstlisting}
"%funct7:7 %rs2:5 %rs1:5 %funct3:3 %rd:5 %opcode:7";
\end{lstlisting}

\end{frame}

\begin{frame}[fragile]{Formats}

\begin{lstlisting}

AC_ISA(riscv)
{

ac_format rtype = "%funct7:7 %rs2:5 %rs1:5 %funct3:3 %rd:5 %opcode:7";

}

\end{lstlisting}

\end{frame}

\begin{frame}{Instructions}

Instructions represent `individually decodable' units
\begin{itemize}
\item Somewhat flexible...
\item<2-> But decode as much as possible at decode time!
\item<3-> i.e., avoid general `ALU' instructions
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Instructions}

\begin{lstlisting}

AC_ISA(riscv)
{

ac_format rtype = "%funct7:7 %rs2:5 %rs1:5 %funct3:3 %rd:5 %opcode:7";

ac_instr<rtype> add;

}

\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Decoding}

Let's consider an example from RISC-V:

\pause

\centering{
RISC-V R-Type
\includegraphics[width=\textwidth]{figures/format-riscv}
}

\bigskip
\pause

\centering{
RISC-V ADD
\includegraphics[width=\textwidth]{figures/risc-v-add}
}

\pause
\bigskip

\ttfamily\scriptsize{
\begin{tabular}{l l}
funct7 & 0b0000000 \\
funct3 & 0b000 \\
opcode & 0b0110011 \\
\end{tabular}
}

\pause

\begin{lstlisting}
add.set_decoder(funct7=0x0, funct=0x0, opcode=0x33);
\end{lstlisting}

\end{frame}

\begin{frame}[fragile]{Decoding}

\begin{lstlisting}

AC_ISA(riscv)
{

ac_format rtype = "%funct7:7 %rs2:5 %rs1:5 %funct3:3 %rd:5 %opcode:7";

ac_instr<rtype> add;

isa_ctor(riscv)
{

add.set_decoder(funct7=0x0, funct=0x0, opcode=0x33);

}

}

\end{lstlisting}
\end{frame}


\begin{frame}{Branch Metadata}

% DBT systems can take advantage

% Can't easily tell if an instruction is a jump
% - would need to detect writes to PC register
% - could be aliased with a bank

\end{frame}
